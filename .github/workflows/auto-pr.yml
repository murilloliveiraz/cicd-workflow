name: Auto PR to develop

on:
  push:
    branches-ignore:
      - main
      - develop

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Get current branch
        id: vars
        run: echo "branch=${GITHUB_REF#refs/heads/}" >> $GITHUB_OUTPUT

      - name: Create PR to develop
        uses: actions/github-script@v7
        with:
          script: |
            const branch = "${{ steps.vars.outputs.branch }}";

            // evita PR da develop → develop
            if (branch === "develop") {
              return;
            }

            try {
              await github.rest.pulls.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `Auto PR: ${branch} → develop`,
                head: branch,
                base: "develop"
              });
            } catch (e) {
              if (e.status === 422) {
                console.log("PR já existe");
              } else {
                throw e;
              }
            }
